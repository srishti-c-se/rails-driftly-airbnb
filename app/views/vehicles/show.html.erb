<h1><%= @vehicle.title %></h1>

<h2>Vehicle Details:</h2>
<p>
  <strong>Brand:</strong> <%= @vehicle.brand %><br>
  <strong>Model:</strong> <%= @vehicle.model %><br>
  <strong>Year:</strong> <%= @vehicle.year %>
</p>
<p><strong>Address:</strong> <%= @vehicle.address %></p>
<p><strong>Seats:</strong> <%= @vehicle.seats %></p>
<p><strong>Transmission:</strong> <%= @vehicle.transmission %></p>
<p><strong>Fuel Type:</strong> <%= @vehicle.fuel_type %></p>
<p><strong>Description:</strong> <%= @vehicle.description %></p>
<p><strong>Price per day:</strong> <%= @vehicle.price_per_day %></p>

<div class="mb-3">
  <%= link_to 'Home Page', vehicles_path, class: 'btn btn-primary' %>
  <%= link_to 'Edit Details', edit_vehicle_path(@vehicle), class: 'btn btn-warning' %>
  <%= link_to 'Delete', vehicle_path(@vehicle),
      data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
      class: 'btn btn-danger' %>
</div>

<hr>

<h2>Book this <%= @vehicle.title %></h2>
<%= simple_form_for [@vehicle, @booking] do |f| %>
  <%= f.input :start_date %>
  <%= f.input :end_date %>
  <%= f.submit %>
<% end %>


<% if @bookings.exists? %>
  <h2>Your bookings</h2>
  <ul>
    <% @bookings.each do |booking| %>
      <li>
        <%= link_to "#{booking.start_date.strftime("%a %b %e")} - #{booking.end_date.strftime("%a %b %e")}", booking %>
      </li>
    <% end %>
  </ul>
<% end %>

<hr>

<% if user_signed_in? && current_user.bookings.exists?(vehicle: @vehicle, status: "completed") %>
  <h3>Leave a Review</h3>
  <%= form_with(model: [@vehicle, @review]) do |f| %>
    <div class="mb-2">
      <%= f.label :rating, "Rating (0–5)" %><br>
      <%= f.number_field :rating, in: 0..5, required: true, class: "form-control" %>
    </div>

    <div class="mb-2">
      <%= f.label :comment, "Comment (optional)" %><br>
      <%= f.text_area :comment, rows: 3, class: "form-control" %>
    </div>

    <%= f.submit "Submit Review", class: "btn btn-success" %>
  <% end %>
<% elsif user_signed_in? %>
  <p><em>You can only review this vehicle after completing a booking.</em></p>
<% else %>
  <p><%= link_to "Sign in to leave a review", new_user_session_path %></p>
<% end %>

<hr>

<h2>Reviews</h2>
<% if @reviews.any? %>
  <% @reviews.each do |review| %>
    <p>
      <strong><%= review.user.first_name %>:</strong>
      <%= "⭐" * review.rating %> (<%= review.rating %>/5)
    </p>

    <% if review.comment.present? %>
      <p><%= review.comment %></p>
    <% end %>
  <% end %>
<% else %>
  <p>No reviews yet.</p>
<% end %>
